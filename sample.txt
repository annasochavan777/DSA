# Define directories
$backupDir = "C:\AutoSys_Backup"       # Folder containing original JIL files
$modifiedDir = "C:\AutoSys_Modified"   # Folder to store modified JIL files
$dbMappingFile = "C:\AutoSys_Backup\db_mapping.csv"  # CSV file with old-new DB instance pairs

# Ensure modified directory exists
if (!(Test-Path $modifiedDir)) {
    New-Item -ItemType Directory -Path $modifiedDir
}

# Read the old-new DB mapping from CSV
$dbMappings = Import-Csv $dbMappingFile

# Process each JIL file
Get-ChildItem -Path $backupDir -Filter "*.jil" | ForEach-Object {
    $filePath = $_.FullName
    $newFilePath = "$modifiedDir\$_"

    Write-Host "Processing file: $filePath"

    # Read file content
    $content = Get-Content $filePath

    # Loop through each DB mapping and replace instances
    foreach ($mapping in $dbMappings) {
        $oldDB = $mapping.OldDBInstance
        $newDB = $mapping.NewDBInstance
        $content = $content -replace $oldDB, $newDB
    }

    # Save modified content to a new file
    $content | Set-Content $newFilePath

    Write-Host "Modified file saved as: $newFilePath"
}

Write-Host "All JIL files have been updated successfully!"

OldDBInstance,NewDBInstance
OLD_DB_1,NEW_DB_1
OLD_DB_2,NEW_DB_2
OLD_DB_3,NEW_DB_3
