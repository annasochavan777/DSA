Import-Module WebAdministration

function Get-AllIISApplicationTrustLevels {
    # Get all websites
    $sites = Get-ChildItem "IIS:\Sites"

    foreach ($site in $sites) {
        $siteName = $site.Name
        
        # Get trust level for the website
        $trustLevel = Get-WebConfigurationProperty -Filter "/system.web/trust" -Name "level" -PSPath "IIS:\Sites\$siteName"
        
        if ($trustLevel) {
            Write-Host "Trust Level for Website '$siteName': $trustLevel"
        } else {
            Write-Host "Trust Level not explicitly set for Website '$siteName'. (Default: Full trust)"
        }

        # Get all web applications under this site
        $apps = Get-WebApplication -Site $siteName

        foreach ($app in $apps) {
            $appPath = $app.Path.Trim('/')
            $appTrustLevel = Get-WebConfigurationProperty -Filter "/system.web/trust" -Name "level" -PSPath "IIS:\Sites\$siteName\$appPath"

            if ($appTrustLevel) {
                Write-Host "  -> Trust Level for Web Application '$appPath' in '$siteName': $appTrustLevel"
            } else {
                Write-Host "  -> Trust Level not explicitly set for Web Application '$appPath'. (Default: Full trust)"
            }
        }
    }
}

# Run the function
Get-AllIISApplicationTrustLevels
