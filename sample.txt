# Parameters
$sshUrl = "ssh://git@stash.example.com:7999/PROJECT_KEY/REPO_SLUG.git"
$branch = "main" # Branch, tag, or commit
$filePath = "src/main/resources/config.json" # File path in the repository
$outputFolder = "$PWD\DownloadedFiles" # Local folder to store the file
$outputFile = Join-Path -Path $outputFolder -ChildPath ([System.IO.Path]::GetFileName($filePath))

# Ensure output folder exists
if (-not (Test-Path -Path $outputFolder)) {
    New-Item -ItemType Directory -Path $outputFolder | Out-Null
}

# Construct Git command
$gitCommand = "git archive --remote=$sshUrl $branch $filePath | tar -x -O > `"$outputFile`""

# Execute Git command
Write-Output "Downloading file via SSH..."
Invoke-Expression $gitCommand

# Check if file exists
if (Test-Path -Path $outputFile) {
    Write-Output "File downloaded successfully: $outputFile"
} else {
    Write-Output "Failed to download file."
}
