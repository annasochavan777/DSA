Import-Module WebAdministration

function Get-AllIISApplicationTrustLevels {
    # Get all websites
    $sites = Get-ChildItem "IIS:\Sites"

    foreach ($site in $sites) {
        $siteName = $site.Name
        Write-Host "Checking Website: $siteName"

        # Get trust level from applicationHost.config
        $trustLevel = Get-WebConfigurationProperty -Filter "/system.web/trust" -Name "level" -PSPath "MACHINE/WEBROOT/APPHOST/$siteName"

        if ($trustLevel -and $trustLevel.Value) {
            Write-Host "Trust Level for Website '$siteName': $($trustLevel.Value)"
        } else {
            Write-Host "Trust Level not explicitly set for Website '$siteName'. (Default: Full trust)"
        }

        # Get all web applications under this site
        $apps = Get-WebApplication -Site $siteName

        foreach ($app in $apps) {
            $appPath = $app.Path.Trim('/')
            $appConfigPath = "MACHINE/WEBROOT/APPHOST/$siteName/$appPath"

            # Get trust level for the web application
            $appTrustLevel = Get-WebConfigurationProperty -Filter "/system.web/trust" -Name "level" -PSPath $appConfigPath

            if ($appTrustLevel -and $appTrustLevel.Value) {
                Write-Host "  -> Trust Level for Web Application '$appPath' in '$siteName': $($appTrustLevel.Value)"
            } else {
                Write-Host "  -> Trust Level not explicitly set for Web Application '$appPath'. (Default: Full trust)"
            }
        }
    }
}

# Run the function
Get-AllIISApplicationTrustLevels
