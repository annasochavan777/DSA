# Define old and new database instance names
$oldDBInstance = "OLD_DB_INSTANCE"
$newDBInstance = "NEW_DB_INSTANCE"

# Define working directories
$backupDir = "C:\AutoSys_Backup"
$modifiedDir = "C:\AutoSys_Modified"

# Create directories if they donâ€™t exist
if (!(Test-Path $backupDir)) { New-Item -ItemType Directory -Path $backupDir }
if (!(Test-Path $modifiedDir)) { New-Item -ItemType Directory -Path $modifiedDir }

# Get all AutoSys jobs
$jobList = & autojob -L  # Fetch all job names

# Process each job
foreach ($job in $jobList) {
    Write-Host "Processing job: $job"

    # Export current job definition
    $jilFile = "$backupDir\$job.jil"
    $modifiedJilFile = "$modifiedDir\$job.jil"

    & autojob -q $job > $jilFile

    # Read content and replace old DB instance with the new one
    (Get-Content $jilFile) -replace $oldDBInstance, $newDBInstance | Set-Content $modifiedJilFile

    # Load the modified JIL file back to AutoSys
    & jil < $modifiedJilFile

    Write-Host "Updated job: $job"
}

Write-Host "All jobs have been updated successfully!"
