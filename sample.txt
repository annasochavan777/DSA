using System;
using System.IO;
using System.Text;
using System.Xml.Linq;

class Program
{
    static void Main()
    {
        string sourceFilePath = "source.xml";  // Path of the source XML file
        string destinationFilePath = "output.xml"; // Path of the output XML file

        try
        {
            // Load XML content into memory
            XDocument xmlDocument;
            using (FileStream fileStream = new FileStream(sourceFilePath, FileMode.Open, FileAccess.Read, FileShare.Read))
            {
                xmlDocument = XDocument.Load(fileStream);
            }

            // Write to MemoryStream first
            using (MemoryStream memoryStream = new MemoryStream())
            {
                using (StreamWriter writer = new StreamWriter(memoryStream, Encoding.UTF8))
                {
                    xmlDocument.Save(writer);
                }

                // Ensure the memory stream is fully written before saving to file
                File.WriteAllBytes(destinationFilePath, memoryStream.ToArray());
            }

            Console.WriteLine("XML file processed and saved successfully.");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error: {ex.Message}");
        }
    }
}
